<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>TKR Relatives</title>
		<link rel="icon" type="image/png" href="/static/Favicon.png">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity = "sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin = "anonymous">
        <link rel="stylesheet" href="/static/sixtyfoldcoloum.css">
		<style>
			.btnstretch {
				width: 100%;
			}
			html, body {
				min-height: 100%;
			}
			body, div, form, input, select, p {
				padding: 0;
				margin: 0;
				outline: none;
				font-family: Roboto, Arial, sans-serif;
				font-size: 14px;
				color: #666;
			}
			h1 {
				margin: 0;
				font-weight: 400;
			}
			form {
				padding: 20px;
			}
			select {
				height: 35px;
				width: 100%;
				padding-left: 5px;
				vertical-align: middle;
				margin-top: 2px;
				margin-bottom: 2px;
			}
			input {
				width: 100%;
				padding: 5px;
				margin-top: 2px;
				margin-bottom: 2px;
				vertical-align: middle;
			}
			.btn-default {
				border: 1px solid #000;
			}
		</style>
	</head>
	<body>
		{% include "_navbar.html" %}
        {% include "_messages.html" %}
		<form method="POST" action="/details/edit">
			<h1 style="text-align: center;">Edit your account</h1>
			<div class="row">
				<div class="col-xs-5 col-sm-5 col-md-5 col-lg-15 col-xl-15"></div>
				<div class="col-xs-50 col-sm-50 col-md-50 col-lg-30 col-xl-30">
					<div class="form-group"><!--address-->
						<h4>Address :</h4>
						<input class="text" type="text" style="width: 50%; margin-right: -4px;" name="housest" value="{{profile.housestreet}}">
						<input class="text" type="text" style="width: 50%; margin-right: -4px;" name="locality" value="{{profile.neighbourhood}}">
						<select id="selectcountry" name="country" onchange="showState()" style="width: 50%; margin-right: -4px;">
							<option value="" hidden>Country</option>
							{% for country in country %}
								<option value="{{country[1]}} | {{country[0]}}">{{country[1]}}</option>
							{% endfor %}
						</select>
						<select id="selectstate" name="state" onchange="showCity()" style="width: 50%; margin-right: -4px;">
							<option value="" hidden>State</option>
							<option value="">Select Country</option>
						</select>
						<select id="selectcity" name="city" style="width: 50%; margin-right: -4px;">
							<option value="" hidden>City</option>
							<option value="">Select State</option>
						</select>
						<input class="text" type="text" style="width: 50%; margin-right: -4px;" name="pincode" value="{{profile.pincode}}">
					</div>
					<div id="phone" class="form-group"><!--phone-->
						<h4>Phone Number :</h4>
						<div id="extraphone2">
							<input type="text" name="phone" style="display: none;">
						</div>
					</div>
					<a href="#addphonenum" class="btn btn-default" style="width: 50%;" data-toggle="tab" onclick="showPhoneInput()">Add Phone Number</a>
				</div>
			</div>
			<div style="text-align: center;">
				<button class="btn btn-primary"onclick="phoneNumberCollect()" value="Submit">Submit</button>
			</div>
			<div style="text-align: center;">
				<a class="btn btn-default" href="/index/sorting/default/asc">Back</a>
			</div>
		</form>
		<script>
			var list = "{{profile.phone}}".split(", ");
			for (let i = 0; i < list.length; i++) {
				showPhoneInput(list[i]);
			}
			var selectedcountry = document.getElementById("selectcountry");
			for (let i = 0; i < selectedcountry.length; i++) {
				if (selectedcountry.options[i].text == "{{profile.country}}"){
					selectedcountry.options[i].selected = true;
					showState();
				}
			}
			var selectedstate = document.getElementById("selectstate");
			for (let i = 0; i < selectedstate.length; i++) {
				if (selectedstate.options[i].text == "{{profile.state}}") {
					selectedstate.options[i].selected = true;
					showCity();
				}
			}
			var selectedcity = document.getElementById("selectcity");
			for (let i = 0; i < selectedcity.length; i++) {
				if (selectedcity.options[i].text == "{{profile.city}}") {
					selectedcity.options[i].selected = true;
				}
			}
			function eraseoptions(elementid, check) {
				var options = document.getElementById(elementid);
				i = 2;
				while (i < options.length) {
					var num =  options.length
					options.removeChild(options.lastElementChild);
				}
				if (elementid === "selectcity" && check ==="1") {
					var a = document.createElement("option");
					a.setAttribute("value", "");
					a.innerHTML = "Select State";
					options.appendChild(a);
				}
			}
			function showState() {
				eraseoptions("selectstate", "2");
				eraseoptions("selectcity", "1");
				thist = document.getElementById("selectcountry");
				var country = thist.options[thist.selectedIndex].value;
				var countryid = country.split(" | ")[1];
				var states = "{{states}}".split("[");
				for (let i = 2; i < states.length; i++) {
					var coloumns = states[i].replace("],",'').split(",");
					if (coloumns[0] == countryid) {
						var statename = coloumns[2].replace("&#39;","");
						var statename = statename.replace("&#39;","");
						var statevalue = [statename, "|", coloumns[1]];
						var x = document.createElement("option");
						x.setAttribute("value", statevalue.join(""));
						var z = document.createTextNode(statename);
						x.appendChild(z);
						document.getElementById("selectstate").appendChild(x);
					}
				}
			}
			function showCity() {
				eraseoptions("selectcity", "2");
				thist = document.getElementById("selectstate");
				var state = thist.options[thist.selectedIndex].value;
				var stateid = state.split(" | ")[1];
				var cities = "{{cities}}".split("[");
				for (let i = 2; i < cities.length; i++) {
					var coloumns = cities[i].replace("],",'').split(",");
					if (coloumns[0] == stateid) {
						var cityname = coloumns[2].replace("&#39;","");
						var cityname = cityname.replace("&#39;","");
						var x = document.createElement("option");
						x.setAttribute("value", cityname);
						var z = document.createTextNode(cityname);
						x.appendChild(z);
						document.getElementById("selectcity").appendChild(x);
					}
				}
			}
			function showPhoneInput(phonenumber) {
				if (phonenumber != undefined) {
					var phonenum = phonenumber.split(" ");
				}
				var anotherphone = document.getElementById("phone");
				var lastelement = anotherphone.children.length;
				var rowdiv = document.createElement("div");
				var predivid = document.getElementById("phone").children.item(lastelement-1).getAttribute("id").replace("extraphone", "");
				var nowdivid = Number(predivid) + 1;
				divid = "extraphone" + String(nowdivid);
				rowdiv.setAttribute("id", divid);
				rowdiv.setAttribute("class", "row");
				rowdiv.setAttribute("style", "margin: 0px;")
				anotherphone.appendChild(rowdiv);
				/**/
				var select = document.createElement("select");
				select.setAttribute("class", "col-10");
				select.setAttribute("style", "padding-right: 0px; padding-left: 0px; font-size: small; margin-top: 2px; margin-bottom: 2px;");
				anotherphone.children.item(lastelement).appendChild(select);
				/**/
				var phonecode = "{{phonecode}}".split("[").slice(2);
				for (let i = 0; i < 250; i++) {
					var phonedet = phonecode[i].split(", ").slice(1);
					var phone = phonedet[1].replace("&#39;","")
					var phone = phone.replace("&#39;]","")
					var phonecount = phonedet[0].replace("&#39;","")
					var phonecount = phonecount.replace("&#39;","")
					var option = document.createElement("option");
					option.setAttribute("value", phone);
					if (phonenumber != undefined && phone == phonenum[0]) {
						var indextoselect = i;
					}
					option.innerHTML = phone + " " + phonecount;
					anotherphone.children.item(lastelement).children.item(0).appendChild(option);
				}
				if (phonenumber == undefined) {
					anotherphone.children.item(lastelement).children.item(0).options[102].selected = true;
				} else {
					anotherphone.children.item(lastelement).children.item(0).options[indextoselect].selected = true;
				}
				/**/
				var input = document.createElement("INPUT");
				input.setAttribute("type", "tel");
				input.setAttribute("class", "col-30");
				input.setAttribute("pattern", "[0-9]{[0-20]}");
				input.setAttribute("title", "Enter only numbers")
				input.setAttribute("style", "padding: 5px");
				if (phonenumber != undefined) {
					input.setAttribute("value", phonenum[1]);
				}
				input.setAttribute("required", "");
				anotherphone.children.item(lastelement).appendChild(input);
				/**/
				if (phonenumber == undefined || lastelement > 2) {
					var deletebutton = document.createElement("button");
					deletebutton.setAttribute("onclick", "deletePhone("+divid+")")
					deletebutton.setAttribute("class", "btn btn-default");
					deletebutton.setAttribute("style", "border-color: transparent")
					deletebutton.setAttribute("data-toggle", "tab");
					deletebutton.innerHTML = "X";
					anotherphone.children.item(lastelement).appendChild(deletebutton);
				}
			}
			function deletePhone(divid) {
				divid.remove();
			}
			function phoneNumberCollect() {
				var phoneParent = document.getElementById("phone");
				var last = phoneParent.children.length;
				var combinedphone = phoneParent.children.item(2).children.item(0).value + " " + phoneParent.children.item(2).children.item(1).value;
				if (last > 2) {
					for (let i = 3; i < last; i++) {
						combinedphone = combinedphone + ", " + phoneParent.children.item(i).children.item(0).value + " " + phoneParent.children.item(i).children.item(1).value;
					}
				}
				document.getElementById("phone").children.item(1).children.item(0).value = combinedphone;
			}
		</script>
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	</body>
</html>
